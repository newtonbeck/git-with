#!/usr/bin/env python3
import sys
import yaml
import users

def help():
    print("""
git-with

Usage:
    git-with introduce <alias> <name> <email>       Introduces a new person to the script

    git-with <alias-1> <...> <alias-n>              Configures people that will be added as co-authors to your next commits

Example:
    git-with introduce bilbo "Bilbo Baggings" bilbo.baggings@shire.org

    git-with bilbo gandalf
    """)

def introduce(alias, name, email):
    users.introduce(alias, name, email)
    print("ğŸ‘‹ welcome {name}! You are now introduced to become a git co-author âœï¸ in the future".replace("{name}", name))

def add(aliases):
    added_aliases = users.add(aliases)
    print("ğŸ‰ now <{aliases}> will be added as co-author(s) âœï¸ to your git commits ğŸš€".replace("{aliases}", ', '.join(added_aliases)))
    if (len(aliases) > len(added_aliases)):
        unknonw_aliases = list(set(aliases).union(set(added_aliases)) - set(aliases).intersection(set(added_aliases)))
        print("âš ï¸ <{unknown_aliases}> won't be added as co-author(s) because they were not introduce to me yet.".replace("{unknown_aliases}", ", ".join(unknonw_aliases)))
        print("Please introduce ğŸ¤ them to me first")

def main():
    if len(sys.argv) > 1:
        match sys.argv[1]:
            case "introduce": introduce(sys.argv[2], sys.argv[3], sys.argv[4])
            case _: 
                if len(sys.argv) > 2: 
                    add(sys.argv[2:])
    else:
        help()

if __name__ == "__main__":
    main()
